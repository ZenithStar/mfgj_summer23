[gd_scene load_steps=20 format=3 uid="uid://bd4xkstaqln3m"]

[ext_resource type="Script" path="res://scripts/bat.gd" id="1_jso4m"]
[ext_resource type="SpriteFrames" uid="uid://cdbwbvrp3o5sf" path="res://assets/v1.1 dungeon crawler 16X16 pixel pack/enemies/flying creature/flier.tres" id="1_u5jt1"]
[ext_resource type="Script" path="res://prefabs/ai/BatEnemyAI.gd" id="2_qkhfp"]
[ext_resource type="Script" path="res://addons/beehave/nodes/composites/selector.gd" id="4_imk3u"]
[ext_resource type="Script" path="res://addons/beehave/nodes/composites/sequence.gd" id="5_5o2i8"]
[ext_resource type="Script" path="res://addons/beehave/nodes/composites/sequence_reactive.gd" id="5_p0i0k"]
[ext_resource type="PackedScene" uid="uid://cmmnyywipci2m" path="res://prefabs/ai/low_hp.tscn" id="6_sokal"]
[ext_resource type="PackedScene" uid="uid://lqx3ugixas1d" path="res://prefabs/ai/target_sighted.tscn" id="7_1trkb"]
[ext_resource type="Script" path="res://addons/beehave/nodes/leaves/action.gd" id="8_yrjg4"]
[ext_resource type="Script" path="res://addons/beehave/nodes/decorators/inverter.gd" id="9_k838t"]
[ext_resource type="PackedScene" uid="uid://bsili00atopun" path="res://prefabs/ai/patrol.tscn" id="10_llqhl"]
[ext_resource type="PackedScene" uid="uid://cc6fmpfhuxu1v" path="res://prefabs/ai/orbit.tscn" id="11_vni1q"]
[ext_resource type="PackedScene" uid="uid://0a0ul2g6l2p6" path="res://prefabs/ai/pre_orbit.tscn" id="12_e1w7d"]
[ext_resource type="Script" path="res://addons/beehave/nodes/decorators/RandomTimeLimiterDecorator.gd" id="12_j80wp"]
[ext_resource type="Script" path="res://addons/beehave/nodes/decorators/time_limiter.gd" id="13_18scf"]
[ext_resource type="PackedScene" uid="uid://b5c8gaa4pmr3i" path="res://prefabs/ai/charge.tscn" id="16_ac5d8"]

[sub_resource type="CircleShape2D" id="CircleShape2D_j0ffp"]
radius = 4.0

[sub_resource type="GDScript" id="GDScript_46cpb"]
script/source = "extends Area2D

func _on_body_entered(body):
	if body is Hero:
		$\"..\".establish_target(body)
	elif body is Enemy:
		$\"..\".nearby_friendlies[body] = null

func _on_body_exited(body):
	pass
"

[sub_resource type="CircleShape2D" id="CircleShape2D_khpvr"]
radius = 100.0

[node name="Spawn" type="Node2D"]

[node name="Bat" type="CharacterBody2D" parent="."]
collision_layer = 2
collision_mask = 3
script = ExtResource("1_jso4m")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Bat"]
shape = SubResource("CircleShape2D_j0ffp")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="Bat"]
sprite_frames = ExtResource("1_u5jt1")
animation = &"fly"
autoplay = "fly"
frame_progress = 0.00307654

[node name="Detection" type="Area2D" parent="Bat"]
script = SubResource("GDScript_46cpb")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Bat/Detection"]
shape = SubResource("CircleShape2D_khpvr")

[node name="BatEnemyAI" type="Node" parent="Bat"]
script = ExtResource("2_qkhfp")

[node name="Either" type="Node" parent="Bat/BatEnemyAI"]
script = ExtResource("4_imk3u")

[node name="Low HP" type="Node" parent="Bat/BatEnemyAI/Either"]
script = ExtResource("5_p0i0k")

[node name="Low HP" parent="Bat/BatEnemyAI/Either/Low HP" instance=ExtResource("6_sokal")]

[node name="Flee" type="Node" parent="Bat/BatEnemyAI/Either/Low HP"]
script = ExtResource("5_p0i0k")

[node name="TargetSighted" parent="Bat/BatEnemyAI/Either/Low HP/Flee" instance=ExtResource("7_1trkb")]

[node name="Flee" type="Node" parent="Bat/BatEnemyAI/Either/Low HP/Flee"]
script = ExtResource("8_yrjg4")

[node name="Recover" type="Node" parent="Bat/BatEnemyAI/Either/Low HP"]
script = ExtResource("8_yrjg4")

[node name="High HP" type="Node" parent="Bat/BatEnemyAI/Either"]
script = ExtResource("4_imk3u")

[node name="Patrol" type="Node" parent="Bat/BatEnemyAI/Either/High HP"]
script = ExtResource("5_p0i0k")

[node name="NotTargetSighted" type="Node" parent="Bat/BatEnemyAI/Either/High HP/Patrol"]
script = ExtResource("9_k838t")

[node name="TargetSighted" parent="Bat/BatEnemyAI/Either/High HP/Patrol/NotTargetSighted" instance=ExtResource("7_1trkb")]

[node name="Patrol" parent="Bat/BatEnemyAI/Either/High HP/Patrol" instance=ExtResource("10_llqhl")]

[node name="Attack" type="Node" parent="Bat/BatEnemyAI/Either/High HP"]
script = ExtResource("5_5o2i8")

[node name="PreOrbit" parent="Bat/BatEnemyAI/Either/High HP/Attack" instance=ExtResource("12_e1w7d")]

[node name="DoneOrbitting" type="Node" parent="Bat/BatEnemyAI/Either/High HP/Attack"]
script = ExtResource("9_k838t")

[node name="OrbitTimeout" type="Node" parent="Bat/BatEnemyAI/Either/High HP/Attack/DoneOrbitting"]
script = ExtResource("12_j80wp")
wait_time = 9.9807

[node name="Orbit" parent="Bat/BatEnemyAI/Either/High HP/Attack/DoneOrbitting/OrbitTimeout" instance=ExtResource("11_vni1q")]

[node name="Charge" type="Node" parent="Bat/BatEnemyAI/Either/High HP/Attack"]
script = ExtResource("13_18scf")
wait_time = 4.0

[node name="Charge" parent="Bat/BatEnemyAI/Either/High HP/Attack/Charge" instance=ExtResource("16_ac5d8")]

[connection signal="body_entered" from="Bat/Detection" to="Bat/Detection" method="_on_body_entered"]
[connection signal="body_exited" from="Bat/Detection" to="Bat/Detection" method="_on_body_exited"]
